name: mdb-updates
prefect-version: 3.1.15

pull:
- prefect.deployments.steps.git_clone:
    id: clone-step
    branch: main
    repository: https://github.com/nelsonwmoore/bento-mdb-updates.git   # will change to CBIIT/bento-mdb
- prefect.deployments.steps.run_shell_script:
    id: install-dependencies
    script: sh -c "cd bento-mdb-updates-main && uv pip install --system . && uv sync
      --frozen"

work_pool:
  name: mdb-docker-pool
  job_variables: prefect-worker:latest
  image_pull_policy: Never
deployments:
- name: update-terms-test3
  version:
  tags: []
  concurrency_limit:
  description: Check for new CDE PVs and syonyms and generate Cypher to update the
    database.
  entrypoint: scripts/update_terms.py:update_terms
  parameters: {}
  work_pool:
    name: mdb-docker-pool
    work_queue_name:
    job_variables:
      image: '{{ build-image.image }}'
  schedules: []
  build:
  - prefect_docker.deployments.steps.build_docker_image:
      requires: prefect-docker>=0.3.1
      id: build-image
      dockerfile: Dockerfile
      image_name: nelsonwmoore/prefect-worker
      tag: latest
- name: test-neo4j-update
  version:
  tags: []
  concurrency_limit:
  description: Update the Neo4j database.
  entrypoint: tests\samples\test_prefect_flow.py:test_update_neo4j_flow
  parameters: {}
  work_pool:
    name: mdb-8gb-prefect-2.20.3-python3.9
    work_queue_name:
    job_variables: {}
  schedules: []
- name: liquibase-update
  version:
  tags: []
  concurrency_limit:
  description: Update the Neo4j database.
  entrypoint: scripts/update_mdb.py:liquibase_update_flow
  parameters: {}
  work_pool:
    name: fnl-mdb-8gb-prefect-2.20.3-python3.9
    work_queue_name:
    job_variables: {}
- name: update-mdb-and-dh
  version:
  tags: []
  concurrency_limit:
  description: Update the Neo4j database and datahub terms repo.
  entrypoint: scripts/update_mdb_and_dh.py:update_mdb_and_dh_flow
  parameters: {}
  work_pool:
    name: fnl-mdb-8gb-prefect-2.20.3-python3.9
    work_queue_name:
    job_variables: {}
- name: update-datahub
  version:
  tags: []
  concurrency_limit:
  description: Update datahub terms repo.
  entrypoint: scripts/update_dh.py:update_datahub_flow
  parameters: {}
  work_pool:
    name: fnl-mdb-8gb-prefect-2.20.3-python3.9
    work_queue_name:
    job_variables: {}
- name: update-terms
  version:
  tags: []
  concurrency_limit:
  description: Check for term source updates and update MDB and DH
  entrypoint: scripts/update_terms.py:update_terms
  parameters: {}
  work_pool:
    name: fnl-mdb-8gb-prefect-2.20.3-python3.9
    work_queue_name:
    job_variables: {}